!function(){"use strict";var e="PHANTOM",o={getStore:function(){return JSON.parse(localStorage.getItem(e))},hasStore:function(){return null!==this.getStore()},saveStore:function(t){console.log("Saving data to localStorage"),localStorage.setItem(e,JSON.stringify(t))},removeStore:function(){localStorage.removeItem(e)}},i=[{id:0,label:"Blog of Cats",url:"http://random.cat",tags:[]},{id:1,label:"Blog of Dogs",url:"",tags:[]},{id:2,label:"Blog of Witches",url:"",tags:[]}],r={collection:[],setData:function(t,e){return this.pagination=e,this.collection=t,this},create:function(t){this.collection.unshift({id:Date.now(),label:"",url:""}),console.log("Bookmark Collection",this.collection),o.saveStore(this.collection),t(this.collection)},update:function(n,t){var a=s(n.filter(function(t){return"id"===t.key}).pop().value);this.collection=this.collection.map(function(t){return t.id===a?(e=t,i={},n.forEach(function(t){i[t.key]="id"===t.key?s(t.value):t.value}),Object.assign(e,i)):t;var e,i}),o.saveStore(this.collection),t(this.collection)},getPaginated:function(){var t,n,e=(t="page",n={},location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,i){n[e]=i}),n[t]||n);return"string"==typeof e?this.sortBookmarks(s(e)):this.sortBookmarks()},sortBookmarks:function(t){void 0===t&&(t=1);var e=(t-1)*this.pagination,i=e+this.pagination,n=e<this.collection.length?e:0;return this.collection.slice(n,i)},removeItemById:function(t,e){var i=this.collection.map(function(t){return Math.abs(t.id)}).indexOf(t);this.collection.splice(i,1),o.saveStore(this.collection),e(this.collection)}};function s(t){return Math.abs(t)}function n(t){var e=0<t.url.length?"":"is-deactivated";return'\n\t\t<div class="bookmark_item" data-id="'+t.id+'">\n\t\t\t<div class="action-link '+e+'">\n\t\t\t\t<div class="fa--bm"></div>\n\t\t\t\t<a href="'+t.url+'" target="_blank">'+t.label+'</a>\n\t\t\t</div>\n\t\t\t<div class="action-edit">\n\t\t\t\t<div class="fa--edit"></div>\n\t\t\t\t<span>Edit</span>\n\t\t\t</div>\n\t\t\t<div class="action-remove">\n\t\t\t\t<div class="fa--remove"></div>\n\t\t\t\t<span>Remove</span>\n\t\t\t</div>\n\t\t</div>\n\t'}function a(t){var n={};return location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,i){n[e]=i}),n[t]||n}var l={overview:{mount:function(t){var n=this;this.mounted&&!t||(this.children.newitem=this.el.querySelector(".action-add"),this.children.bookmarks=this.el.querySelectorAll(".bookmark_item"),this.children.bookmarks.forEach(function(e){var t=e.querySelector(".action-edit"),i=e.querySelector(".action-remove");t.addEventListener("click",function(t){return n.editBookmark(e)}),i.addEventListener("click",function(t){return n.removeBookmark(e)})}),this.children.newitem.addEventListener("click",function(t){return n.createBookmark()}),this.mounted=!0)},editBookmark:function(t){var e=Math.abs(t.dataset.id),i=this.parent.state.bookmarks.getPaginated().filter(function(t){return t.id===e}).pop();this.el.classList.add("has-blur"),this.parent.dom.editor.updateMarkup(i),this.parent.updateView("edit")},removeBookmark:function(t){var e=this,i=Math.abs(t.dataset.id);this.parent.state.bookmarks.removeItemById(i,function(t){e.updateMarkup(t),e.parent.updateView("remove")})},createBookmark:function(){var i=this;this.parent.state.bookmarks.create(function(t){var e=i.parent.state.bookmarks.getPaginated(t);i.updateMarkup(e),i.parent.updateView("list")})},updateMarkup:function(t){this.markup.partial=t.map(n),this.markup.template='\n\t\t<div class="bookmarks_container">\n\t\t\t<div class="collection">\n\t\t\t\t'+this.markup.partial.join("")+'\n\t\t\t</div>\n\t\t\t<div class="action-add">\n\t\t\t\t<div class="fa--add"></div>\n\t\t\t\t<span>Add new link</span>\n\t\t\t</div>\n\t\t</div>\n\t'},getTemplate:function(){return this.markup.template}},editor:{mount:function(t){var e=this;if(!this.mounted||t){var i=this.children;i.form=this.el.querySelector(".editor_form"),i.close=this.el.querySelector(".fa--close"),i.validation=this.el.querySelector(".validation--url"),i.close.addEventListener("click",function(){return e.closeViewTo()}),i.form.addEventListener("submit",function(t){return e.formSubmit(t)}),this.mounted=!0}this.handleView()},handleView:function(){var t=this;setTimeout(function(){t.el.classList.add("is-active")},50)},closeViewTo:function(t){void 0===t&&(t="list"),this.el.classList.remove("is-active"),this.parent.updateView(t)},updateMarkup:function(t){var e;this.markup.template='\n\t\t<div class="content is-card">\n\t\t\t<div class="head">\n\t\t\t\t<div class="fa--close"></div>\n\t\t\t</div>\n\t\t\t<div class="body">\n\t\t\t\t<form class="editor_form">\n\t\t\t\t\t<input type="hidden" value="'+(e=t||"").id+'" name="id" class="is-model"/>\n\t\t\t\t\t<div class="field">\n\t\t\t\t\t\t<div class="fa--pen"></div>\n\t\t\t\t\t\t<label>Label</label>\n\t\t\t\t\t\t<input type="text" value="'+e.label+'" name="label" class="is-model"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="field validation--url">\n\t\t\t\t\t\t<div class="fa--url"></div>\n\t\t\t\t\t\t<label>URL</label>\n\t\t\t\t\t\t<input type="text" value="'+e.url+'" placeholder="https://sample.com" name="url" class="is-model"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button type="submit" class="editor_submit">Submit</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},getTemplate:function(){return this.markup.template},formSubmit:function(t){var e=this;t.preventDefault();var i=this.children.form.querySelectorAll(".is-model"),n=[];i.forEach(function(t){n.push({key:t.name,value:t.value})}),this.children.validation.classList.contains("has-error")&&this.children.validation.classList.remove("has-error"),this.validateFields(n).then(function(){e.parent.state.bookmarks.update(n,function(t){e.parent.dom.overview.updateMarkup(t),e.closeViewTo("response")})}).catch(function(t){return e.handleError(t)})},validateFields:function(a){return new Promise(function(t,e){var i,n=a.filter(function(t){return"url"===t.key}).pop();""==n.value||(i=n.value,new RegExp("^(https?://)?([-a-z0-9]{1,63}\\.)*?[a-z0-9][-a-z0-9]{0,61}[a-z0-9]\\.[a-z]{2,6}(/[-\\w@\\+\\.~#\\?&/=%]*)?$","i").test(i))?t():e({type:"validation",code:500,message:"not a valid url"})})},handleError:function(t){console.log(t),this.children.validation.classList.add("has-error")}},response:{mount:function(t){var e=this;this.mounted&&!t||(this.children.close=this.el.querySelector(".fa--close"),this.children.close.addEventListener("click",function(){return e.closeViewTo()}),this.mounted=!0),this.handleView()},handleView:function(){this.el.classList.add("is-active")},closeViewTo:function(t){void 0===t&&(t="list"),this.el.classList.remove("is-active"),this.parent.updateView(t)}},footer:{mount:function(){},updateMarkup:function(){var t=this.pageCount(),e="string"==typeof a("page")?Math.abs(a("page")):1;this.markup.template=function(t,e){for(var i=[],n=1;n<=t;n++){var a=e===n?" is-active":"";i.push('\n\t\t\t<div class="link_wrap'+a+'">\n\t\t\t\t<div class="fa--link"></div>\n\t\t\t\t<a href="http://localhost:3000?page='+n+'">'+n+"</a>\n\t\t\t</div>\n\t\t")}return i}(t,e).join("")},pageCount:function(){var t=this.parent.state.bookmarks.collection.length;return Math.ceil(t/this.parent.state.pagination)},getTemplate:function(){return this.markup.template}}},c={make:function(t){var e=Object.keys(t).pop(),i=t[e];return Object.assign(l[e],{name:e,parent:this,el:i,children:{},markup:{},mounted:!1})}},d=function(t){return new u(t)},u=function(t,e){void 0===e&&(e=5);var i=document.querySelector(".overview_container"),n=document.querySelector(".modal--editor"),a=document.querySelector(".modal--response"),o=document.querySelector(".page_links");this.state={bookmarks:r.setData(t,e),pagination:e,mode:"list"},this.dom={overview:c.make.call(this,{overview:i}),editor:c.make.call(this,{editor:n}),response:c.make.call(this,{response:a}),footer:c.make.call(this,{footer:o})},this.dom.overview.updateMarkup(this.state.bookmarks.getPaginated()),this.dom.footer.updateMarkup(),this.render()};u.prototype.updateView=function(t){this.state.mode=t,this.dom.footer.updateMarkup(),this.render()},u.prototype.render=function(){var t=this.dom;switch(this.state.mode){case"response":t.response.mount();break;case"edit":t.editor.el.innerHTML=t.editor.getTemplate(),t.editor.el.innerHTML.length!=t.editor.getTemplate().length?t.editor.mount(!0):t.editor.handleView();break;case"remove":t.overview.el.innerHTML=t.overview.getTemplate(),t.footer.el.innerHTML=t.footer.getTemplate(),t.overview.mount(!0);break;default:t.overview.el.classList.contains("has-blur")&&t.overview.el.classList.remove("has-blur"),t.overview.el.innerHTML=t.overview.getTemplate(),t.overview.mount(!0),t.footer.el.innerHTML=t.footer.getTemplate()}};var t={init:function(){(function(t){t||o.saveStore(i);var e=o.getStore();return{loadView:function(t){t(e)}}})(o.hasStore()).loadView(function(t){return d(t)})},reset:function(){o.hasStore()&&o.removeStore(),console.log("LocalStorage has been cleared :)")}};window.phantom=t,window.phantom.init()}();
//# sourceMappingURL=bundle.js.map
